#include <stdlib.h>
#include <string.h>
#include <stdio.h>

int main() {
	puts("This file contains a use-after-free vulnerability");
	puts("It can be exploited to alter the contents of a chunk");

	char *chunk1 = malloc(1024);
	printf("Allocated 32 bytes at %p\n", chunk1);
	char *chunk2 = malloc(1024);
	printf("Allocated 32 bytes at %p\n", chunk2);

	free(chunk1);
	puts("Freeing chunk 1");
	free(chunk2);
	puts("Freeing chunk 2\n");

	puts("Copying data into chunk2");
	strcpy(chunk2, "Original value");
	char *chunk3 = malloc(2048);
	printf("Allocated 64 bytes at %p\n", chunk3);

	puts("Data to copy:");
	char temp[2048];
	gets(temp);
	puts("Got user input");
	strcpy(chunk3, temp);
	puts("Copied user input to heap");

	printf("\nData in chunk 3 is: %s\n", chunk3);
	printf("\nData in chunk 2 is: %s\n", chunk2);

	if (strcmp(chunk2, "bypass") == 0) {
		puts("\nBYPASS SUCEEDED!!!!!!!!!!!!");
	} else {
		puts("Bypass failed");
	}
	//gets(chunk3);
}
